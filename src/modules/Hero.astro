---
import { ButtonLink, TextLink } from "@components/ui";
import { GITHUB_URL, LINKEDIN_URL, MAIL_URL } from "@constants";
import { Image } from "astro:assets";
import luccaImage from "@assets/lucca/lucca-sofa.jpg";
import coffeeGif from "@assets/lucca/coffee-optimized.mp4";
import { baseSpacing } from "@constants";
---

<div
  class={`${baseSpacing} text-white pt-12 md:pt-24 lg:pt-12 xl:pt-24 pb-12 md:pb-20 mb-16 md:mb-36 bg-neutral-primary overflow-visible`}
>
  <div
    class="relative flex flex-col lg:flex-row gap-8 w-full justify-start mx-auto max-w-[1440px]"
  >
    <div
      class="flex flex-col gap-4 lg:gap-10 w-full pt-4 md:pt-10 pl-0 xl:pl-24"
    >
      <h1
        data-text="Lucca Romaniello"
        class="relative z-10 anaglyph text-start text-4xl sm:text-7xl 2xl:text-8xl font-satoshi leading-tight font-bold
              text-white tracking-wider uppercase"
      >
        Lucca Romaniello
      </h1>
      <div
        class="flex flex-col gap-3 leading-relaxed text-lg md:text-2xl lg:text-xl lg:max-w-[480px] xl:max-w-[640px]"
      >
        <p class="text-balance text-content-tertiary">
          Full Stack Engineer with a product design background. 6+ years
          blending engineering and design.
        </p>
        <p class="text-sm md:text-lg text-content-tertiary lg:text-balance">
          Based in Brazil, working globally. Open to full-time and freelance
          work.
        </p>
      </div>
      <div
        class="grid grid-cols-2 md:grid-cols-3 w-full md:w-fit gap-4 md:gap-6 pt-4 mb-0 md:mb-4 lg:mb-0"
      >
        <ButtonLink
          icon="github"
          label="GitHub"
          href={GITHUB_URL}
          theme="dark"
          external
          trackEvent="github-btn-hero"
        />
        <ButtonLink
          icon="linkedin"
          label="LinkedIn"
          href={LINKEDIN_URL}
          theme="dark"
          external
          trackEvent="linkedin-btn-hero"
        />
        <div class="col-span-2 md:col-span-1">
          <ButtonLink
            icon="mail"
            label="Contact"
            href={MAIL_URL}
            theme="dark"
            copyToClipboard={MAIL_URL}
            trackEvent="mail-btn-hero"
          />
        </div>
      </div>
    </div>
    <div
      class="relative lg:absolute lg:right-0 xl:right-0 2xl:right-24 w-full lg:w-[380px] xl:w-[480px] xl:h-[560px]"
    >
      <div class="flex flex-col gap-3 md:gap-3 justify-center text-center">
        <p
          class="md:hidden font-caveat text-xl text-content-secondary text-center mt-4"
        >
          Coffee's on me. Tap to grab yours.
        </p>
        <div
          id="hero-media"
          oncontextmenu="return false"
          class="relative border-2 border-white shadow-[3px_3px_0_0_#AE1E5F] rounded-xl overflow-hidden cursor-pointer"
        >
          <Image
            src={luccaImage}
            alt="Lucca Romaniello"
            class="object-contain object-center md:-mt-56 lg:-mt-0 xl:-mt-32 transition-opacity duration-150 will-change-[opacity]"
            id="hero-image"
            loading="eager"
            fetchpriority="high"
            data-umami-event="img-hero"
          />
          <video
            autoplay
            muted
            playsinline
            preload="auto"
            loop
            class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-150 will-change-[opacity]"
            id="hero-video"
          >
            <source src={coffeeGif} type="video/mp4" />
            Your browser does not support the video tag.
          </video>
          <p
            id="hero-video-text"
            class="absolute bottom-4 left-0 right-0 text-center font-caveat text-3xl lg:text-2xl text-white opacity-0 transition-opacity duration-150 will-change-[opacity] z-10"
          >
            This one's for you. Sugar?
          </p>
        </div>
        <div class="text-white lg:text-neutral-primary/90">
          <p class="font-caveat text-xl md:text-2xl lg:text-2xl">
            On most days, you’ll find me with some
            <TextLink
              link={{
                label: "pão de queijo",
                url: "https://en.wikipedia.org/wiki/P%C3%A3o_de_queijo",
              }}
              size="large"
              cursive
            />
            and a cup of coffee. No sugar.
          </p>
          <p
            class="hidden xl:block absolute font-caveat text-2xl xl:bottom-60 -right-42 rotate-90 text-content-secondary"
          >
            Coffee's on me. Hover to grab yours.
          </p>
          <p
            class="hidden md:block xl:hidden absolute font-caveat text-xl lg:text-xl md:bottom-58 lg:bottom-74 right-0 md:-right-34 md:rotate-90 text-content-secondary"
          >
            Coffee's on me. Tap to grab yours.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const container = document.getElementById("hero-media");
  const image = document.getElementById("hero-image") as HTMLImageElement;
  const video = document.getElementById("hero-video") as HTMLVideoElement;
  const text = document.getElementById(
    "hero-video-text",
  ) as HTMLParagraphElement;

  let playing = false;
  let playPromise: Promise<void> | null = null;

  function showVideo() {
    image.style.opacity = "0";
    video.style.opacity = "1";
    text.style.opacity = "1";
    video.currentTime = 0;
    playPromise = video.play();
    playing = true;
  }

  function hideVideo() {
    const hide = () => {
      image.style.opacity = "1";
      video.style.opacity = "0";
      text.style.opacity = "0";
      video.pause();
      playing = false;
      playPromise = null;
    };

    if (playPromise) {
      playPromise.then(hide).catch(() => {});
    } else {
      hide();
    }
  }

  let isTouch = false;

  container?.addEventListener(
    "touchstart",
    () => {
      isTouch = true;
    },
    { passive: true },
  );

  container?.addEventListener("mouseenter", () => {
    if (!isTouch) showVideo();
  });

  container?.addEventListener("mouseleave", () => {
    if (!isTouch) hideVideo();
  });

  container?.addEventListener("click", () => {
    if (!isTouch) return;
    if (playing) {
      hideVideo();
    } else {
      showVideo();
    }
    isTouch = false;
  });
</script>
