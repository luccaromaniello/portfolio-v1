---
import { SOCIAL_ICONS } from "@constants";

interface Props {
  icon?: keyof typeof SOCIAL_ICONS;
  label: string;
  href: string;
  external?: boolean;
  theme?: "dark" | "light";
  track?: boolean;
  copyToClipboard?: string;
}

const {
  icon,
  label,
  href,
  external = true,
  theme = "light",
  track = false,
  copyToClipboard,
} = Astro.props;
const IconComponent = icon ? SOCIAL_ICONS[icon].icon : null;

const themeClasses = {
  dark: "border-white text-white hover:bg-white hover:text-black",
  light: "border-black text-black hover:bg-black hover:text-white",
};

const sharedClasses = [
  "w-full md:w-auto inline-flex flex-row items-center justify-center gap-2 py-2 md:py-3 px-4 md:py-2 border-2 rounded-sm shadow-[3px_3px_0_0_#AE1E5F] text-sm text-center uppercase font-semibold cursor-pointer",
  themeClasses[theme],
];
---

{
  copyToClipboard ? (
    <button
      data-copy={copyToClipboard}
      aria-label={label}
      class:list={["copy-btn", ...sharedClasses]}
    >
      {IconComponent && <IconComponent class="w-4 h-4" />}
      <span data-copy-label>{label}</span>
    </button>
  ) : (
    <a
      href={href}
      aria-label={label}
      rel={track ? undefined : "noopener noreferrer"}
      target={external ? "_blank" : "_self"}
      class:list={sharedClasses}
    >
      {IconComponent && <IconComponent class="w-4 h-4" />}
      {label}
    </a>
  )
}

<script>
  document.querySelectorAll(".copy-btn").forEach((btn) => {
    let timeout: ReturnType<typeof setTimeout> | null = null;

    btn.addEventListener("click", () => {
      const value = btn.getAttribute("data-copy");
      const label = btn.querySelector("[data-copy-label]") as HTMLElement;
      if (!value || !label) return;

      const original =
        btn.getAttribute("data-original-label") ?? label.innerText;
      if (!btn.getAttribute("data-original-label")) {
        btn.setAttribute("data-original-label", label.innerText);
        label.style.minWidth = `${label.offsetWidth}px`;
      }

      navigator.clipboard.writeText(value);

      if (timeout) clearTimeout(timeout);
      label.innerText = "Copied!";
      timeout = setTimeout(() => {
        label.innerText = original;
        timeout = null;
      }, 1500);
    });
  });
</script>
