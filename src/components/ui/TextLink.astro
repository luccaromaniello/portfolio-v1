---
import { type Link } from "@typeDefs/link";
import { MAIL_URL } from "@constants";

interface Props {
  link: Link;
  size?: "small" | "medium" | "large";
  cursive?: boolean;
}

const { link, size = "medium", cursive = false } = Astro.props;
const { pathname } = Astro.url;

const buttonVariant = {
  small: "text-sm md:text-base",
  medium: "text-md md:text-lg",
  large: "text-lg md:text-2xl",
};

const baseStyle = `
  inline-block text-primary tracking-wide
  border-dashed border-transparent hover:border-primary border-b
  relative hover:text-neutral-primary transition-colors duration-500 ease-in-out transition-opacity duration-500 ease-out
  after:content-[''] after:absolute after:bottom-[-1px] after:left-0 after:h-0.5 after:bg-primary after:w-0 after:block after:transition-[width] after:duration-500 after:ease-in-out hover:after:w-full
`;
---

{
  link.url !== MAIL_URL ? (
    <a
      href={link.url}
      aria-label={link.label}
      target={pathname === link.url ? "_self" : "_blank"}
      rel="noopener noreferrer"
      class={`${buttonVariant[size]} ${baseStyle} ${cursive ? "font-caveat" : ""}`}
    >
      {link.label.trim()}
    </a>
  ) : (
    <button
      class={`email-link ${buttonVariant[size]} ${baseStyle} cursor-pointer`}
    >
      {link.label.trim()}
    </button>
  )
}

<script>
  const emailLinks = document.getElementsByClassName("email-link");

  Array.from(emailLinks).forEach((l) => {
    const link = l as HTMLElement;
    link.addEventListener("click", (event) => {
      copyToClipboard(link);
    });
  });

  function copyToClipboard(link: HTMLElement) {
    const originalLabel = link.innerText;

    navigator.clipboard.writeText(originalLabel);

    link.classList.add("opacity-0");

    setTimeout(() => {
      link.innerText = "Email copied to clipboard!";
      link.classList.remove("opacity-0");
      link.classList.add("opacity-100");
    }, 300);

    setTimeout(() => {
      link.classList.remove("opacity-100");
      link.classList.add("opacity-0");
      setTimeout(() => {
        link.innerText = originalLabel;
        link.classList.remove("opacity-0");
        link.classList.add("opacity-100");
      }, 300);
    }, 1500);
  }
</script>
